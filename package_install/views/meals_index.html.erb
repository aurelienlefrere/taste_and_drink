<%# ============================================ %>
<%# üìÖ EVENTS - Liste des accords plat/boisson %>
<%# ============================================ %>

<div class="td-events-page">

  <%# === HEADER === %>
  <div class="td-events-header">
    <div>
      <h1 class="td-page-title">Mes Events</h1>
      <p class="td-page-subtitle">
        <%= @meals.count %> accord<%= @meals.count > 1 ? 's' : '' %> cr√©√©<%= @meals.count > 1 ? 's' : '' %>
      </p>
    </div>
    <%# Bouton rond pour cr√©er un nouveau match %>
    <%= link_to new_meal_path, class: "td-btn-new-event" do %>
      <i class="fas fa-plus"></i>
    <% end %>
  </div>

  <%# === LISTE DES EVENTS === %>
  <% if @meals.any? %>
    <div class="td-events-list">
      <% @meals.each do |meal| %>

        <%# === CARD D'UN EVENT === %>
        <div class="td-event-card">

          <%# --- En-t√™te : Date, Plat et Avatars --- %>
          <div class="td-event-header-new">
            <%# Badge de date (√† gauche) %>
            <div class="td-event-date">
              <span class="td-date-day">
                <%= meal.date&.strftime("%d") || meal.created_at.strftime("%d") %>
              </span>
              <span class="td-date-month">
                <%= meal.date&.strftime("%b") || meal.created_at.strftime("%b") %>
              </span>
            </div>
            
            <%# Nom du plat (au centre, plus gros) %>
            <div class="td-event-dish-main">
              <h3><%= meal.dish_name %></h3>
            </div>
            
            <%# Avatars des amis (√† droite) %>
            <% if meal.guests.any? %>
              <div class="td-event-avatars-inline">
                <% meal.guests.first(3).each do |guest| %>
                  <div class="td-guest-avatar-inline" title="<%= guest.user.first_name %>">
                    <% if guest.user.photo.present? %>
                      <%= image_tag guest.user.photo, alt: guest.user.first_name %>
                    <% else %>
                      <span><%= guest.user.first_name&.first&.upcase || "?" %></span>
                    <% end %>
                  </div>
                <% end %>
                <% if meal.guests.count > 3 %>
                  <div class="td-guest-avatar-inline td-avatar-more">
                    <span>+<%= meal.guests.count - 3 %></span>
                  </div>
                <% end %>
              </div>
            <% end %>
          </div>

          <%# --- Section Boissons --- %>
          <% if meal.meal_drinks.any? %>
            <div class="td-event-drinks">
              <% meal.meal_drinks.each do |meal_drink| %>
                <div class="td-drink-item">
                  <%# Image de la bouteille %>
                  <div class="td-drink-image">
                    <% if meal_drink.drink.photo.present? %>
                      <img src="<%= meal_drink.drink.photo %>" alt="<%= meal_drink.drink.title %>">
                    <% else %>
                      <%# Placeholder si pas d'image %>
                      <div class="td-drink-placeholder">
                        <i class="fas fa-wine-bottle"></i>
                      </div>
                    <% end %>
                  </div>

                  <%# Infos de la boisson %>
                  <div class="td-drink-info">
                    <span class="td-drink-name">
                      <%= truncate(meal_drink.drink.title, length: 25) %>
                    </span>
                    <span class="td-drink-details">
                      <%= meal_drink.drink.category %>
                      <% if meal_drink.drink.year.present? %>
                        ‚Ä¢ <%= meal_drink.drink.year %>
                      <% end %>
                    </span>
                  </div>
                </div>
              <% end %>
            </div>
          <% end %>

        </div>
        <%# === FIN CARD === %>

      <% end %>
    </div>

  <% else %>
    <%# === √âTAT VIDE (quand il n'y a aucun event) === %>
    <div class="td-empty-state">
      <div class="td-empty-icon">
        <i class="fas fa-calendar-plus"></i>
      </div>
      <h3>Aucun event</h3>
      <p>Cr√©ez votre premier accord plat & boisson !</p>
      <%= link_to "Cr√©er un Match", new_meal_path, class: "btn btn-gold" %>
    </div>
  <% end %>

</div>
